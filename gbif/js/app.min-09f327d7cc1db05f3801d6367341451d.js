!function(angular){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(e,r,a,t,n){var o;return{restrict:"EA",replace:!0,scope:{center:"=",defaults:"=",maxbounds:"=",bounds:"=",markers:"=",legend:"=",geojson:"=",paths:"=",tiles:"=",layers:"=",controls:"=",decorations:"=",eventBroadcast:"=",markersWatchOptions:"=",geojsonWatchOptions:"="},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(r){o=e.defer(),this.getMap=function(){return o.promise},this.getLeafletScope=function(){return r}}],link:function(e,l,i){function s(){isNaN(i.width)?l.css("width",i.width):l.css("width",i.width+"px")}function u(){isNaN(i.height)?l.css("height",i.height):l.css("height",i.height+"px")}var c=t.isDefined,d=a.setDefaults(e.defaults,i.id),f=n.genDispatchMapEvent,p=n.getAvailableMapEvents();r.setDirectiveControls({},i.id),c(i.width)&&(s(),e.$watch(function(){return l[0].getAttribute("width")},function(){s(),g.invalidateSize()})),c(i.height)&&(u(),e.$watch(function(){return l[0].getAttribute("height")},function(){u(),g.invalidateSize()}));var g=new L.Map(l[0],a.getMapCreationDefaults(i.id));if(o.resolve(g),c(i.center)||g.setView([d.center.lat,d.center.lng],d.center.zoom),!c(i.tiles)&&!c(i.layers)){var v=L.tileLayer(d.tileLayer,d.tileLayerOptions);v.addTo(g),r.setTiles(v,i.id)}if(c(g.zoomControl)&&c(d.zoomControlPosition)&&g.zoomControl.setPosition(d.zoomControlPosition),c(g.zoomControl)&&d.zoomControl===!1&&g.zoomControl.removeFrom(g),c(g.zoomsliderControl)&&c(d.zoomsliderControl)&&d.zoomsliderControl===!1&&g.zoomsliderControl.removeFrom(g),!c(i.eventBroadcast))for(var y="broadcast",m=0;m<p.length;m++){var h=p[m];g.on(h,f(e,h,y),{eventName:h})}g.whenReady(function(){r.setMap(g,i.id)}),e.$on("$destroy",function(){g.remove(),r.unresolveMap(i.id)}),e.$on("invalidateSize",function(){g.invalidateSize()})}}}]),angular.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(e,r){function a(e){return angular.isDefined(e)&&angular.isDefined(e.southWest)&&angular.isDefined(e.northEast)&&angular.isNumber(e.southWest.lat)&&angular.isNumber(e.southWest.lng)&&angular.isNumber(e.northEast.lat)&&angular.isNumber(e.northEast.lng)}var t=r.isArray,n=r.isNumber;return{createLeafletBounds:function(e){return a(e)?L.latLngBounds([e.southWest.lat,e.southWest.lng],[e.northEast.lat,e.northEast.lng]):void 0},isValidBounds:a,createBoundsFromArray:function(r){return t(r)&&2===r.length&&t(r[0])&&t(r[1])&&2===r[0].length&&2===r[1].length&&n(r[0][0])&&n(r[0][1])&&n(r[1][0])&&n(r[1][1])?{northEast:{lat:r[0][0],lng:r[0][1]},southWest:{lat:r[1][0],lng:r[1][1]}}:void e.error("[AngularJS - Leaflet] The bounds array is not valid.")}}}]),angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletMapDefaults",function(e,r,a,t){var n=a.isDefined,o=a.isObject,l={},i=function(e,r,a){var l=t.getDefaults(a);if(!l.controls.layers.visible)return!1;var i=!1;return o(e)&&Object.keys(e).forEach(function(r){var a=e[r];n(a.layerOptions)&&a.layerOptions.showOnSelector===!1||(i=!0)}),o(r)&&Object.keys(r).forEach(function(e){var a=r[e];n(a.layerParams)&&a.layerParams.showOnSelector===!1||(i=!0)}),i},s=function(e){var r=t.getDefaults(e),a={collapsed:r.controls.layers.collapsed,position:r.controls.layers.position,autoZIndex:!1};angular.extend(a,r.controls.layers.options);var o;return o=r.controls.layers&&n(r.controls.layers.control)?r.controls.layers.control.apply(this,[[],[],a]):new L.control.layers([],[],a)};return{layersControlMustBeVisible:i,updateLayersControl:function(e,r,a,t,o,u){var c,d=l[r],f=i(t,o,r);if(n(d)&&a){for(c in u.baselayers)d.removeLayer(u.baselayers[c]);for(c in u.overlays)d.removeLayer(u.overlays[c]);e.removeControl(d),delete l[r]}if(f){d=s(r),l[r]=d;for(c in t){var p=n(t[c].layerOptions)&&t[c].layerOptions.showOnSelector===!1;!p&&n(u.baselayers[c])&&d.addBaseLayer(u.baselayers[c],t[c].name)}for(c in o){var g=n(o[c].layerParams)&&o[c].layerParams.showOnSelector===!1;!g&&n(u.overlays[c])&&d.addOverlay(u.overlays[c],o[c].name)}e.addControl(d)}return f}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(e,r,a){var t=a.getDefer,n=a.getUnresolvedDefer,o=a.setResolvedDefer,l={},i=this,s=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},u=["map","tiles","layers","paths","markers","geoJSON","UTFGrid","decorations","directiveControls"];u.forEach(function(e){l[e]={}}),this.unresolveMap=function(e){var r=a.obtainEffectiveMapId(l.map,e);u.forEach(function(e){l[e][r]=void 0})},u.forEach(function(e){var r=s(e);i["set"+r]=function(r,a){var t=n(l[e],a);t.resolve(r),o(l[e],a)},i["get"+r]=function(r){var a=t(l[e],r);return a.promise}})}]),angular.module("leaflet-directive").service("leafletDirectiveControlsHelpers",["$log","leafletData","leafletHelpers",function(e,r,a){var t=a.isDefined,n=a.isString,o=a.isObject,l=a.errorHeader,i=l+"[leafletDirectiveControlsHelpers",s=function(a,l,s,u){var c=i+".extend] ",d={};if(!t(l))return void e.error(c+"thingToAddName cannot be undefined");if(n(l)&&t(s)&&t(u))d[l]={create:s,clean:u};else{if(!o(l)||t(s)||t(u))return void e.error(c+"incorrect arguments");d=l}r.getDirectiveControls().then(function(e){angular.extend(e,d),r.setDirectiveControls(e,a)})};return{extend:s}}]),angular.module("leaflet-directive").factory("leafletEvents",["leafletMapEvents","leafletMarkerEvents","leafletPathEvents",function(e,r,a){return angular.extend({},e,{bindMarkerEvents:r.bindEvents,getAvailableMarkerEvents:r.getAvailableEvents},a)}]),angular.module("leaflet-directive").service("leafletGeoJsonHelpers",["leafletHelpers","leafletIterators",function(e,r){var a=e,t=r,n=function(e,r){return this.lat=e,this.lng=r,this},o=function(e){return Array.isArray(e)&&2===e.length?e[1]:a.isDefined(e.type)&&"Point"===e.type?+e.coordinates[1]:+e.lat},l=function(e){return Array.isArray(e)&&2===e.length?e[0]:a.isDefined(e.type)&&"Point"===e.type?+e.coordinates[0]:+e.lng},i=function(e){if(a.isUndefined(e))return!1;if(a.isArray(e)){if(2===e.length&&a.isNumber(e[0])&&a.isNumber(e[1]))return!0}else if(a.isDefined(e.type)&&"Point"===e.type&&a.isArray(e.coordinates)&&2===e.coordinates.length&&a.isNumber(e.coordinates[0])&&a.isNumber(e.coordinates[1]))return!0;var r=t.all(["lat","lng"],function(r){return a.isDefined(e[r])&&a.isNumber(e[r])});return r},s=function(e){if(e&&i(e)){var r=null;if(Array.isArray(e)&&2===e.length)r=new n(e[1],e[0]);else{if(!a.isDefined(e.type)||"Point"!==e.type)return e;r=new n(e.coordinates[1],e.coordinates[0])}return angular.extend(e,r)}};return{getLat:o,getLng:l,validateCoords:i,getCoords:s}}]),angular.module("leaflet-directive").factory("leafletHelpers",["$q","$log",function(e,r){function a(e,a){var t,o;if(angular.isDefined(a))t=a;else if(0===Object.keys(e).length)t="main";else if(Object.keys(e).length>=1)for(o in e)e.hasOwnProperty(o)&&(t=o);else 0===Object.keys(e).length?t="main":r.error(n+"- You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return t}function t(r,t){var n,o=a(r,t);return angular.isDefined(r[o])&&r[o].resolvedDefer!==!0?n=r[o].defer:(n=e.defer(),r[o]={defer:n,resolvedDefer:!1}),n}var n="[AngularJS - Leaflet] ",o=angular.copy,l=o,i=function(e,r){var a;return e&&angular.isObject(e)?null!==r&&angular.isString(r)?(a=e,r.split(".").forEach(function(e){a&&(a=a[e])}),a):r:void 0},s=function(e){return e.split(".").reduce(function(e,r){return e+'["'+r+'"]'})},u=function(e){return e.reduce(function(e,r){return e+"."+r})},c=function(e){return angular.isDefined(e)&&null!==e},d=function(e){return!c(e)};return{copy:o,clone:l,errorHeader:n,getObjectValue:i,getObjectArrayPath:s,getObjectDotPath:u,defaultTo:function(e,r){return c(e)?e:r},isTruthy:function(e){return"true"===e||e===!0},isEmpty:function(e){return 0===Object.keys(e).length},isUndefinedOrEmpty:function(e){return angular.isUndefined(e)||null===e||0===Object.keys(e).length},isDefined:c,isUndefined:d,isNumber:angular.isNumber,isString:angular.isString,isArray:angular.isArray,isObject:angular.isObject,isFunction:angular.isFunction,equals:angular.equals,isValidCenter:function(e){return angular.isDefined(e)&&angular.isNumber(e.lat)&&angular.isNumber(e.lng)&&angular.isNumber(e.zoom)},isValidPoint:function(e){return angular.isDefined(e)?angular.isArray(e)?2===e.length&&angular.isNumber(e[0])&&angular.isNumber(e[1]):angular.isNumber(e.lat)&&angular.isNumber(e.lng):!1},isSameCenterOnMap:function(e,r){var a=r.getCenter(),t=r.getZoom();return e.lat&&e.lng&&a.lat.toFixed(4)===e.lat.toFixed(4)&&a.lng.toFixed(4)===e.lng.toFixed(4)&&t===e.zoom?!0:!1},safeApply:function(e,r){var a=e.$root.$$phase;"$apply"===a||"$digest"===a?e.$eval(r):e.$evalAsync(r)},obtainEffectiveMapId:a,getDefer:function(e,r){var n,o=a(e,r);return n=angular.isDefined(e[o])&&e[o].resolvedDefer!==!1?e[o].defer:t(e,r)},getUnresolvedDefer:t,setResolvedDefer:function(e,r){var t=a(e,r);e[t].resolvedDefer=!0},FullScreenControlPlugin:{isLoaded:function(){return angular.isDefined(L.Control.Fullscreen)}},AwesomeMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)},is:function(e){return this.isLoaded()?e instanceof L.AwesomeMarkers.Icon:!1},equal:function(e,r){return this.isLoaded()&&this.is(e)?angular.equals(e,r):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return angular.isDefined(L.PolylineDecorator)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.PolylineDecorator:!1},equal:function(e,r){return this.isLoaded()&&this.is(e)?angular.equals(e,r):!1}},MakiMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.MakiMarkers.Icon:!1},equal:function(e,r){return this.isLoaded()&&this.is(e)?angular.equals(e,r):!1}},ExtraMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.ExtraMarkers)&&angular.isDefined(L.ExtraMarkers.Icon)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.ExtraMarkers.Icon:!1},equal:function(e,r){return this.isLoaded()&&this.is(e)?angular.equals(e,r):!1}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(e){return this.isLoaded()?e instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(e){return this.isLoaded()?e instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(e){return this.isLoaded()?e instanceof L.Google:!1}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatLayerPlugin:{isLoaded:function(){return angular.isDefined(L.heatLayer)}},WebGLHeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(e){return this.isLoaded()?e instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(e){return this.isLoaded()?e instanceof L.GeoJSON.WFS:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(e){return this.isLoaded()?e instanceof lvector.AGS:!1}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(e){return this.isLoaded()?e instanceof L.Yandex:!1}},DynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(e){return this.isLoaded()?e instanceof L.esri.dynamicMapLayer:!1}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(e){return this.isLoaded()?e instanceof L.TileLayer.GeoJSON:!1}},UTFGridPlugin:{isLoaded:function(){return angular.isDefined(L.UtfGrid)},is:function(e){return this.isLoaded()?e instanceof L.UtfGrid:(r.error("[AngularJS - Leaflet] No UtfGrid plugin found."),!1)}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return!0}},Leaflet:{DivIcon:{is:function(e){return e instanceof L.DivIcon},equal:function(e,r){return this.is(e)?angular.equals(e,r):!1}},Icon:{is:function(e){return e instanceof L.Icon},equal:function(e,r){return this.is(e)?angular.equals(e,r):!1}}},watchOptions:{doWatch:!0,isDeep:!0,individual:{doWatch:!0,isDeep:!0}}}}]),angular.module("leaflet-directive").service("leafletIterators",["$log","leafletHelpers",function(e,r){var a,t=r,n=r.errorHeader+"leafletIterators: ",o=Object.keys,l=t.isFunction,i=t.isObject,s=Math.pow(2,53)-1,u=function(e){var r=null!==e&&e.length;return t.isNumber(r)&&r>=0&&s>=r},c=function(e){return e},d=function(e){return function(r){return null===r?void 0:r[e]}},f=function(e,r,a){if(void 0===r)return e;switch(null===a?3:a){case 1:return function(a){return e.call(r,a)};case 2:return function(a,t){return e.call(r,a,t)};case 3:return function(a,t,n){return e.call(r,a,t,n)};case 4:return function(a,t,n,o){return e.call(r,a,t,n,o)}}return function(){return e.apply(r,arguments)}},p=function(e,r){return function(a){var t=arguments.length;if(2>t||null===a)return a;for(var n=1;t>n;n++)for(var o=arguments[n],l=e(o),i=l.length,s=0;i>s;s++){var u=l[s];r&&void 0!==a[u]||(a[u]=o[u])}return a}},g=null;a=g=p(o);var v,y=function(e,r){var a=o(r),t=a.length;if(null===e)return!t;for(var n=Object(e),l=0;t>l;l++){var i=a[l];if(r[i]!==n[i]||!(i in n))return!1}return!0},m=null;v=m=function(e){return e=a({},e),function(r){return y(r,e)}};var h,L=function(e,r,a){return null===e?c:l(e)?f(e,r,a):i(e)?v(e):d(e)},b=null;h=b=function(e,r,a){r=L(r,a);for(var t=!u(e)&&o(e),n=(t||e).length,l=0;n>l;l++){var i=t?t[l]:l;if(!r(e[i],i,e))return!1}return!0};var k=function(r,a,o,l){return o||t.isDefined(r)&&t.isDefined(a)?t.isFunction(a)?!1:(l=t.defaultTo(a,"cb"),e.error(n+l+" is not a function"),!0):!0},A=function(e,r,a){if(!k(void 0,a,!0,"internalCb")&&!k(e,r))for(var t in e)a(e[t],t)},C=function(e,r){A(e,r,function(e,a){r(e,a)})};return{each:C,forEach:C,every:h,all:b}}]),angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","leafletHelpers","leafletIterators",function($rootScope,$log,leafletHelpers,leafletIterators){function isValidLayerType(e){return isString(e.type)?-1===Object.keys(layerTypes).indexOf(e.type)?($log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes)),!1):layerTypes[e.type].mustHaveUrl&&!isString(e.url)?($log.error("[AngularJS - Leaflet] A base layer must have an url"),!1):layerTypes[e.type].mustHaveData&&!isDefined(e.data)?($log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):layerTypes[e.type].mustHaveLayer&&!isDefined(e.layer)?($log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have an layer defined"),!1):layerTypes[e.type].mustHaveBounds&&!isDefined(e.bounds)?($log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have bounds defined"),!1):layerTypes[e.type].mustHaveKey&&!isDefined(e.key)?($log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have key defined"),!1):!0:($log.error("[AngularJS - Leaflet] A layer must have a valid type defined."),!1)}function createLayer(e){if(isValidLayerType(e)){if(!isString(e.name))return void $log.error("[AngularJS - Leaflet] A base layer must have a name");isObject(e.layerParams)||(e.layerParams={}),isObject(e.layerOptions)||(e.layerOptions={});for(var r in e.layerParams)e.layerOptions[r]=e.layerParams[r];var a={url:e.url,data:e.data,options:e.layerOptions,layer:e.layer,type:e.layerType,bounds:e.bounds,key:e.key,pluginOptions:e.pluginOptions,user:e.user};return layerTypes[e.type].createLayer(a)}}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isArray=leafletHelpers.isArray,isDefined=leafletHelpers.isDefined,$it=leafletIterators,utfGridCreateLayer=function(e){if(!Helpers.UTFGridPlugin.isLoaded())return void $log.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.");var r=new L.UtfGrid(e.url,e.pluginOptions);return r.on("mouseover",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseover",e)}),r.on("mouseout",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseout",e)}),r.on("click",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridClick",e)}),r},layerTypes={xyz:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer(e.url,e.options)}},mapbox:{mustHaveKey:!0,createLayer:function(e){var r="//{s}.tiles.mapbox.com/v3/"+e.key+"/{z}/{x}/{y}.png";return L.tileLayer(r,e.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(e){return Helpers.GeoJSONPlugin.isLoaded()?new L.TileLayer.GeoJSON(e.url,e.pluginOptions,e.options):void 0}},utfGrid:{mustHaveUrl:!0,createLayer:utfGridCreateLayer},cartodbTiles:{mustHaveKey:!0,createLayer:function(e){var r="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/{z}/{x}/{y}.png";return L.tileLayer(r,e.options)}},cartodbUTFGrid:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(e){return e.url="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/"+e.layer+"/{z}/{x}/{y}.grid.json",utfGridCreateLayer(e)}},cartodbInteractive:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(e){var r="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/{z}/{x}/{y}.png",a=L.tileLayer(r,e.options);e.url="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/"+e.layer+"/{z}/{x}/{y}.grid.json";var t=utfGridCreateLayer(e);return L.layerGroup([a,t])}},wms:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wms(e.url,e.options)}},wmts:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wmts(e.url,e.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(params){if(Helpers.WFSLayerPlugin.isLoaded()){var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}}},group:{mustHaveUrl:!1,createLayer:function(e){var r=[];return $it.each(e.options.layers,function(e){r.push(createLayer(e))}),L.layerGroup(r)}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(e){var r=e.type||"SATELLITE";return Helpers.GoogleLayerPlugin.isLoaded()?new L.Google(r,e.options):void 0}},china:{mustHaveUrl:!1,createLayer:function(e){var r=e.type||"";return Helpers.ChinaLayerPlugin.isLoaded()?L.tileLayer.chinaProvider(r,e.options):void 0}},ags:{mustHaveUrl:!0,createLayer:function(e){if(Helpers.AGSLayerPlugin.isLoaded()){var r=angular.copy(e.options);angular.extend(r,{url:e.url});var a=new lvector.AGS(r);return a.onAdd=function(e){this.setMap(e)},a.onRemove=function(){this.setMap(null)},a}}},dynamic:{mustHaveUrl:!0,createLayer:function(e){return Helpers.DynamicMapLayerPlugin.isLoaded()?L.esri.dynamicMapLayer(e.url,e.options):void 0}},markercluster:{mustHaveUrl:!1,createLayer:function(e){return Helpers.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(e.options):void $log.error("[AngularJS - Leaflet] The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(e){return Helpers.BingLayerPlugin.isLoaded()?new L.BingLayer(e.key,e.options):void 0}},webGLHeatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(e){if(Helpers.WebGLHeatMapLayerPlugin.isLoaded()){var r=new L.TileLayer.WebGLHeatMap(e.options);return isDefined(e.data)&&r.setData(e.data),r}}},heat:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(e){if(Helpers.HeatLayerPlugin.isLoaded()){var r=new L.heatLayer;return isArray(e.data)&&r.setLatLngs(e.data),isObject(e.options)&&r.setOptions(e.options),r}}},yandex:{mustHaveUrl:!1,createLayer:function(e){var r=e.type||"map";return Helpers.YandexLayerPlugin.isLoaded()?new L.Yandex(r,e.options):void 0}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(e){return L.imageOverlay(e.url,e.bounds,e.options)}},custom:{createLayer:function(e){return e.layer instanceof L.Class?angular.copy(e.layer):void $log.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}},cartodb:{mustHaveUrl:!0,createLayer:function(e){return cartodb.createLayer(e.map,e.url)}}};return{createLayer:createLayer}}]),angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var e=function(e,r,a,t){if(e.innerHTML="",r.error)e.innerHTML+='<div class="info-title alert alert-danger">'+r.error.message+"</div>";else if("arcgis"===a)for(var n=0;n<r.layers.length;n++){var o=r.layers[n];e.innerHTML+='<div class="info-title" data-layerid="'+o.layerId+'">'+o.layerName+"</div>";for(var l=0;l<o.legend.length;l++){var i=o.legend[l];e.innerHTML+='<div class="inline" data-layerid="'+o.layerId+'"><img src="data:'+i.contentType+";base64,"+i.imageData+'" /></div><div class="info-label" data-layerid="'+o.layerId+'">'+i.label+"</div>"}}else"image"===a&&(e.innerHTML='<img src="'+t+'"/>')},r=function(r,a,t,n){return function(){var o=L.DomUtil.create("div",a);return L.Browser.touch?L.DomEvent.on(o,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(o),L.DomEvent.on(o,"mousewheel",L.DomEvent.stopPropagation)),e(o,r,t,n),o}},a=function(e,r){return function(){for(var a=L.DomUtil.create("div",r),t=0;t<e.colors.length;t++)a.innerHTML+='<div class="outline"><i style="background:'+e.colors[t]+'"></i></div><div class="info-label">'+e.labels[t]+"</div>";return L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(a),L.DomEvent.on(a,"mousewheel",L.DomEvent.stopPropagation)),a}};return{getOnAddLegend:r,getOnAddArrayLegend:a,updateLegend:e}}),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(e,r){function a(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,tap:!0,touchZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var t=r.isDefined,n=r.isObject,o=r.obtainEffectiveMapId,l={};return{getDefaults:function(e){var r=o(l,e);return l[r]},getMapCreationDefaults:function(e){var r=o(l,e),a=l[r],n={maxZoom:a.maxZoom,keyboard:a.keyboard,dragging:a.dragging,zoomControl:a.zoomControl,doubleClickZoom:a.doubleClickZoom,scrollWheelZoom:a.scrollWheelZoom,tap:a.tap,touchZoom:a.touchZoom,attributionControl:a.attributionControl,worldCopyJump:a.worldCopyJump,crs:a.crs};if(t(a.minZoom)&&(n.minZoom=a.minZoom),t(a.zoomAnimation)&&(n.zoomAnimation=a.zoomAnimation),t(a.fadeAnimation)&&(n.fadeAnimation=a.fadeAnimation),t(a.markerZoomAnimation)&&(n.markerZoomAnimation=a.markerZoomAnimation),a.map)for(var i in a.map)n[i]=a.map[i];return n},setDefaults:function(e,r){var i=a();t(e)&&(i.doubleClickZoom=t(e.doubleClickZoom)?e.doubleClickZoom:i.doubleClickZoom,i.scrollWheelZoom=t(e.scrollWheelZoom)?e.scrollWheelZoom:i.doubleClickZoom,i.tap=t(e.tap)?e.tap:i.tap,i.touchZoom=t(e.touchZoom)?e.touchZoom:i.doubleClickZoom,i.zoomControl=t(e.zoomControl)?e.zoomControl:i.zoomControl,i.zoomsliderControl=t(e.zoomsliderControl)?e.zoomsliderControl:i.zoomsliderControl,i.attributionControl=t(e.attributionControl)?e.attributionControl:i.attributionControl,i.tileLayer=t(e.tileLayer)?e.tileLayer:i.tileLayer,i.zoomControlPosition=t(e.zoomControlPosition)?e.zoomControlPosition:i.zoomControlPosition,i.keyboard=t(e.keyboard)?e.keyboard:i.keyboard,i.dragging=t(e.dragging)?e.dragging:i.dragging,t(e.controls)&&angular.extend(i.controls,e.controls),n(e.crs)?i.crs=e.crs:t(L.CRS[e.crs])&&(i.crs=L.CRS[e.crs]),t(e.center)&&angular.copy(e.center,i.center),t(e.tileLayerOptions)&&angular.copy(e.tileLayerOptions,i.tileLayerOptions),t(e.maxZoom)&&(i.maxZoom=e.maxZoom),t(e.minZoom)&&(i.minZoom=e.minZoom),t(e.zoomAnimation)&&(i.zoomAnimation=e.zoomAnimation),t(e.fadeAnimation)&&(i.fadeAnimation=e.fadeAnimation),t(e.markerZoomAnimation)&&(i.markerZoomAnimation=e.markerZoomAnimation),t(e.worldCopyJump)&&(i.worldCopyJump=e.worldCopyJump),t(e.map)&&(i.map=e.map),t(e.path)&&(i.path=e.path));var s=o(l,r);return l[s]=i,i}}}]),angular.module("leaflet-directive").service("leafletMarkersHelpers",["$rootScope","$timeout","leafletHelpers","$log","$compile","leafletGeoJsonHelpers",function(e,r,a,t,n,o){var l=a.isDefined,i=a.defaultTo,s=a.MarkerClusterPlugin,u=a.AwesomeMarkersPlugin,c=a.MakiMarkersPlugin,d=a.ExtraMarkersPlugin,f=a.safeApply,p=a,g=a.isString,v=a.isNumber,y=a.isObject,m={},h=o,b=a.errorHeader,k=function(e){var r="";return["_icon","_latlng","_leaflet_id","_map","_shadow"].forEach(function(a){r+=a+": "+i(e[a],"undefined")+" \n"}),"[leafletMarker] : \n"+r},A=function(e,r){var a=r?console:t;a.debug(k(e))},C=function(e){if(l(e)&&l(e.type)&&"awesomeMarker"===e.type)return u.isLoaded()||t.error(b+" The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(e);if(l(e)&&l(e.type)&&"makiMarker"===e.type)return c.isLoaded()||t.error(b+"The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(e);if(l(e)&&l(e.type)&&"extraMarker"===e.type)return d.isLoaded()||t.error(b+"The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(e);if(l(e)&&l(e.type)&&"div"===e.type)return new L.divIcon(e);if(l(e)&&l(e.type)&&"icon"===e.type)return e.icon;var r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";return l(e)&&l(e.iconUrl)?new L.Icon(e):new L.Icon.Default({iconUrl:r,shadowUrl:a,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})},w=function(e){l(m[e])&&m.splice(e,1)},O=function(){m={}},D=function(e,r,a){if(e.closePopup(),l(a)&&l(a.overlays))for(var t in a.overlays)if((a.overlays[t]instanceof L.LayerGroup||a.overlays[t]instanceof L.FeatureGroup)&&a.overlays[t].hasLayer(e))return void a.overlays[t].removeLayer(e);if(l(m))for(var n in m)m[n].hasLayer(e)&&m[n].removeLayer(e);r.hasLayer(e)&&r.removeLayer(e)},H=function(a,t){a.openPopup();var o=angular.isFunction(t.getMessageScope)?t.getMessageScope():e,i=l(t.compileMessage)?t.compileMessage:!0,s=function(e){if(l(e)&&l(e._contentNode)){var a=function(e){e._updateLayout(),e._updatePosition()};if(n(e._contentNode)(o),e._contentNode.innerHTML.indexOf("ngInclude")>-1)var t=o.$on("$includeContentLoaded",function(){a(e),t()});else r(function(){a(e)})}};i&&s(a.getPopup())},P=function(r,a){var t=angular.isFunction(a.getMessageScope)?a.getMessageScope():e,o=angular.isFunction(a.getLabelScope)?a.getLabelScope():t,i=l(a.compileMessage)?a.compileMessage:!0;p.LabelPlugin.isLoaded()&&l(a.label)&&(l(a.label.options)&&a.label.options.noHide===!0&&r.showLabel(),i&&l(r.label)&&n(r.label._container)(o))};return{resetMarkerGroup:w,resetMarkerGroups:O,deleteMarker:D,manageOpenPopup:H,manageOpenLabel:P,createMarker:function(e){if(!l(e)||!h.validateCoords(e))return void t.error(b+"The marker definition is not valid.");var r=h.getCoords(e);if(!l(r))return void t.error(b+"Unable to get coordinates from markerData.");var a={icon:C(e.icon),title:l(e.title)?e.title:"",draggable:l(e.draggable)?e.draggable:!1,clickable:l(e.clickable)?e.clickable:!0,riseOnHover:l(e.riseOnHover)?e.riseOnHover:!1,zIndexOffset:l(e.zIndexOffset)?e.zIndexOffset:0,iconAngle:l(e.iconAngle)?e.iconAngle:0};for(var n in e)e.hasOwnProperty(n)&&!a.hasOwnProperty(n)&&(a[n]=e[n]);var o=new L.marker(r,a);return g(e.message)||o.unbindPopup(),o},addMarkerToGroup:function(e,r,a,n){return g(r)?s.isLoaded()?(l(m[r])||(m[r]=new L.MarkerClusterGroup(a),n.addLayer(m[r])),void m[r].addLayer(e)):void t.error(b+"The MarkerCluster plugin is not loaded."):void t.error(b+"The marker group you have specified is invalid.")},listenMarkerEvents:function(e,r,a){e.on("popupopen",function(){f(a,function(){r.focus=!0,H(e,r)})}),e.on("popupclose",function(){f(a,function(){r.focus=!1})}),e.on("add",function(){f(a,function(){"label"in r&&P(e,r)})})},addMarkerWatcher:function(e,r,a,n,o,s){var u=p.getObjectArrayPath("markers."+r);s=i(s,!0);var c=a.$watch(u,function(r,a){if(!l(r))return D(e,o,n),void c();if(l(a)){if(!h.validateCoords(r))return t.warn("There are problems with lat-lng data, please verify your marker model"),void D(e,o,n);var i=r===a;if(l(r.iconAngle)&&a.iconAngle!==r.iconAngle&&e.setIconAngle(r.iconAngle),g(r.layer)||g(a.layer)&&(l(n.overlays[a.layer])&&n.overlays[a.layer].hasLayer(e)&&(n.overlays[a.layer].removeLayer(e),
e.closePopup()),o.hasLayer(e)||o.addLayer(e)),(v(r.opacity)||v(parseFloat(r.opacity)))&&r.opacity!==a.opacity&&e.setOpacity(r.opacity),g(r.layer)&&a.layer!==r.layer){if(g(a.layer)&&l(n.overlays[a.layer])&&n.overlays[a.layer].hasLayer(e)&&n.overlays[a.layer].removeLayer(e),e.closePopup(),o.hasLayer(e)&&o.removeLayer(e),!l(n.overlays[r.layer]))return void t.error(b+"You must use a name of an existing layer");var s=n.overlays[r.layer];if(!(s instanceof L.LayerGroup||s instanceof L.FeatureGroup))return void t.error(b+'A marker can only be added to a layer of type "group" or "featureGroup"');s.addLayer(e),o.hasLayer(e)&&r.focus===!0&&H(e,r)}if(r.draggable!==!0&&a.draggable===!0&&l(e.dragging)&&e.dragging.disable(),r.draggable===!0&&a.draggable!==!0&&(e.dragging?e.dragging.enable():L.Handler.MarkerDrag&&(e.dragging=new L.Handler.MarkerDrag(e),e.options.draggable=!0,e.dragging.enable())),y(r.icon)||y(a.icon)&&(e.setIcon(C()),e.closePopup(),e.unbindPopup(),g(r.message)&&e.bindPopup(r.message,r.popupOptions)),y(r.icon)&&y(a.icon)&&!angular.equals(r.icon,a.icon)){var u=!1;e.dragging&&(u=e.dragging.enabled()),e.setIcon(C(r.icon)),u&&e.dragging.enable(),e.closePopup(),e.unbindPopup(),g(r.message)&&e.bindPopup(r.message,r.popupOptions)}!g(r.message)&&g(a.message)&&(e.closePopup(),e.unbindPopup()),p.LabelPlugin.isLoaded()&&(l(r.label)&&l(r.label.message)?"label"in a&&"message"in a.label&&!angular.equals(r.label.message,a.label.message)?e.updateLabelContent(r.label.message):angular.isFunction(e.getLabel)?P(e,r):(e.bindLabel(r.label.message,r.label.options),P(e,r)):(!("label"in r)||"message"in r.label)&&angular.isFunction(e.unbindLabel)&&e.unbindLabel()),g(r.message)&&!g(a.message)&&e.bindPopup(r.message,r.popupOptions),g(r.message)&&g(a.message)&&r.message!==a.message&&e.setPopupContent(r.message);var d=!1;r.focus!==!0&&a.focus===!0&&(e.closePopup(),d=!0),(r.focus===!0&&(!l(a.focus)||a.focus===!1)||i&&r.focus===!0)&&(H(e,r),d=!0),a.zIndexOffset!==r.zIndexOffset&&e.setZIndexOffset(r.zIndexOffset);var f=e.getLatLng(),m=g(r.layer)&&p.MarkerClusterPlugin.is(n.overlays[r.layer]);m?d?(r.lat!==a.lat||r.lng!==a.lng)&&(n.overlays[r.layer].removeLayer(e),e.setLatLng([r.lat,r.lng]),n.overlays[r.layer].addLayer(e)):f.lat!==r.lat||f.lng!==r.lng?(n.overlays[r.layer].removeLayer(e),e.setLatLng([r.lat,r.lng]),n.overlays[r.layer].addLayer(e)):r.lat!==a.lat||r.lng!==a.lng?(n.overlays[r.layer].removeLayer(e),e.setLatLng([r.lat,r.lng]),n.overlays[r.layer].addLayer(e)):y(r.icon)&&y(a.icon)&&!angular.equals(r.icon,a.icon)&&(n.overlays[r.layer].removeLayer(e),n.overlays[r.layer].addLayer(e)):(f.lat!==r.lat||f.lng!==r.lng)&&e.setLatLng([r.lat,r.lng])}},s)},string:k,log:A}}]),angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(e,r,a){function t(e){return e.filter(function(e){return c(e)}).map(function(e){return n(e)})}function n(e){return s(e)?new L.LatLng(e[0],e[1]):new L.LatLng(e.lat,e.lng)}function o(e){return e.map(function(e){return t(e)})}function l(e,r){for(var a={},t=0;t<d.length;t++){var n=d[t];i(e[n])?a[n]=e[n]:i(r.path[n])&&(a[n]=r.path[n])}return a}var i=a.isDefined,s=a.isArray,u=a.isNumber,c=a.isValidPoint,d=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],f=function(e,r){for(var a={},t=0;t<d.length;t++){var n=d[t];i(r[n])&&(a[n]=r[n])}e.setStyle(r)},p=function(e){if(!s(e))return!1;for(var r=0;r<e.length;r++){var a=e[r];if(!c(a))return!1}return!0},g={polyline:{isValid:function(e){var r=e.latlngs;return p(r)},createPath:function(e){return new L.Polyline([],e)},setPath:function(e,r){e.setLatLngs(t(r.latlngs)),f(e,r)}},multiPolyline:{isValid:function(e){var r=e.latlngs;if(!s(r))return!1;for(var a in r){var t=r[a];if(!p(t))return!1}return!0},createPath:function(e){return new L.multiPolyline([[[0,0],[1,1]]],e)},setPath:function(e,r){e.setLatLngs(o(r.latlngs)),f(e,r)}},polygon:{isValid:function(e){var r=e.latlngs;return p(r)},createPath:function(e){return new L.Polygon([],e)},setPath:function(e,r){e.setLatLngs(t(r.latlngs)),f(e,r)}},multiPolygon:{isValid:function(e){var r=e.latlngs;if(!s(r))return!1;for(var a in r){var t=r[a];if(!p(t))return!1}return!0},createPath:function(e){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],e)},setPath:function(e,r){e.setLatLngs(o(r.latlngs)),f(e,r)}},rectangle:{isValid:function(e){var r=e.latlngs;if(!s(r)||2!==r.length)return!1;for(var a in r){var t=r[a];if(!c(t))return!1}return!0},createPath:function(e){return new L.Rectangle([[0,0],[1,1]],e)},setPath:function(e,r){e.setBounds(new L.LatLngBounds(t(r.latlngs))),f(e,r)}},circle:{isValid:function(e){var r=e.latlngs;return c(r)&&u(e.radius)},createPath:function(e){return new L.Circle([0,0],1,e)},setPath:function(e,r){e.setLatLng(n(r.latlngs)),i(r.radius)&&e.setRadius(r.radius),f(e,r)}},circleMarker:{isValid:function(e){var r=e.latlngs;return c(r)&&u(e.radius)},createPath:function(e){return new L.CircleMarker([0,0],e)},setPath:function(e,r){e.setLatLng(n(r.latlngs)),i(r.radius)&&e.setRadius(r.radius),f(e,r)}}},v=function(e){var r={};return e.latlngs&&(r.latlngs=e.latlngs),e.radius&&(r.radius=e.radius),r};return{setPathOptions:function(e,r,a){i(r)||(r="polyline"),g[r].setPath(e,a)},createPath:function(e,a,t){i(a.type)||(a.type="polyline");var n=l(a,t),o=v(a);return g[a.type].isValid(o)?g[a.type].createPath(n):void r.error("[AngularJS - Leaflet] Invalid data passed to the "+a.type+" path")}}}]),angular.module("leaflet-directive").service("leafletWatchHelpers",function(){var e=function(e,r,a,t,n){var o=e[r](a,function(e,r){n(e,r),t.doWatch||o()},t.isDeep);return o},r=function(r,a,t,n){return e(r,"$watch",a,t,n)},a=function(r,a,t,n){return e(r,"$watchCollection",a,t,n)};return{maybeWatch:r,maybeWatchCollection:a}}),angular.module("leaflet-directive").directive("bounds",["$log","$timeout","leafletHelpers","leafletBoundsHelpers",function(e,r,a,t){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","center"],link:function(n,o,l,i){var s=a.isDefined,u=t.createLeafletBounds,c=i[0].getLeafletScope(),d=i[0],f=function(e){return 0===e._southWest.lat&&0===e._southWest.lng&&0===e._northEast.lat&&0===e._northEast.lng};d.getMap().then(function(a){c.$on("boundsChanged",function(e){var r=e.currentScope,t=a.getBounds();if(!f(t)&&!r.settingBoundsFromScope){var n={northEast:{lat:t._northEast.lat,lng:t._northEast.lng},southWest:{lat:t._southWest.lat,lng:t._southWest.lng}};angular.equals(r.bounds,n)||(r.bounds=n)}}),c.$watch("bounds",function(t){if(!s(t))return void e.error("[AngularJS - Leaflet] Invalid bounds");var o=u(t);o&&!a.getBounds().equals(o)&&(n.settingBoundsFromScope=!0,a.fitBounds(o),r(function(){n.settingBoundsFromScope=!1}))},!0)})}}}]),angular.module("leaflet-directive").directive("center",["$log","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(e,r,a,t,n,o,l,i){var s,u=o.isDefined,c=o.isNumber,d=o.isSameCenterOnMap,f=o.safeApply,p=o.isValidCenter,g=l.isValidBounds,v=o.isUndefinedOrEmpty,y=function(e,r){return u(e)&&g(e)&&v(r)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){s=r.defer(),this.getCenter=function(){return s.promise}},link:function(r,o,g,v){var m=v.getLeafletScope(),h=m.center;v.getMap().then(function(o){var v=n.getDefaults(g.id);if(-1!==g.center.search("-"))return e.error('The "center" variable can\'t use a "-" on his key name: "'+g.center+'".'),void o.setView([v.center.lat,v.center.lng],v.center.zoom);if(y(m.bounds,h))o.fitBounds(l.createLeafletBounds(m.bounds)),h=o.getCenter(),f(m,function(e){e.center={lat:o.getCenter().lat,lng:o.getCenter().lng,zoom:o.getZoom(),autoDiscover:!1},angular.extend(e.center,{lat:o.getCenter().lat,lng:o.getCenter().lng,zoom:o.getZoom(),autoDiscover:!1})}),f(m,function(e){var r=o.getBounds();e.bounds={northEast:{lat:r._northEast.lat,lng:r._northEast.lng},southWest:{lat:r._southWest.lat,lng:r._southWest.lng}}});else{if(!u(h))return e.error('The "center" property is not defined in the main scope'),void o.setView([v.center.lat,v.center.lng],v.center.zoom);u(h.lat)&&u(h.lng)||u(h.autoDiscover)||angular.copy(v.center,h)}var L,b;if("yes"===g.urlHashCenter){var k=function(){var e,r=a.search();if(u(r.c)){var t=r.c.split(":");3===t.length&&(e={lat:parseFloat(t[0]),lng:parseFloat(t[1]),zoom:parseInt(t[2],10)})}return e};L=k(),m.$on("$locationChangeSuccess",function(e){var r=e.currentScope,a=k();u(a)&&!d(a,o)&&(r.center={lat:a.lat,lng:a.lng,zoom:a.zoom})})}m.$watch("center",function(r){return u(L)&&(angular.copy(L,r),L=void 0),p(r)||r.autoDiscover===!0?r.autoDiscover===!0?(c(r.zoom)||o.setView([v.center.lat,v.center.lng],v.center.zoom),void o.locate(c(r.zoom)&&r.zoom>v.center.zoom?{setView:!0,maxZoom:r.zoom}:u(v.maxZoom)?{setView:!0,maxZoom:v.maxZoom}:{setView:!0})):void(b&&d(r,o)||(m.settingCenterFromScope=!0,o.setView([r.lat,r.lng],r.zoom),i.notifyCenterChangedToBounds(m,o),t(function(){m.settingCenterFromScope=!1}))):void e.warn("[AngularJS - Leaflet] invalid 'center'")},!0),o.whenReady(function(){b=!0}),o.on("moveend",function(){s.resolve(),i.notifyCenterUrlHashChanged(m,o,g,a.search()),d(h,o)||r.settingCenterFromScope||f(m,function(e){m.settingCenterFromScope||angular.extend(e.center,{lat:o.getCenter().lat,lng:o.getCenter().lng,zoom:o.getZoom(),autoDiscover:!1}),i.notifyCenterChangedToBounds(m,o)})}),h.autoDiscover===!0&&o.on("locationerror",function(){e.warn("[AngularJS - Leaflet] The Geolocation API is unauthorized on this page."),p(h)?(o.setView([h.lat,h.lng],h.zoom),i.notifyCenterChangedToBounds(m,o)):(o.setView([v.center.lat,v.center.lng],v.center.zoom),i.notifyCenterChangedToBounds(m,o))})})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(e,r){return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(a,t,n,o){if(o){var l=r.isDefined,i=o.getLeafletScope(),s=i.controls;o.getMap().then(function(a){if(l(L.Control.Draw)&&l(s.draw)){l(s.edit)||(s.edit={featureGroup:new L.FeatureGroup},a.addLayer(s.edit.featureGroup));var t=new L.Control.Draw(s);a.addControl(t)}if(l(s.scale)){var n=new L.control.scale(s.scale);a.addControl(n)}if(l(s.fullscreen))if(r.FullScreenControlPlugin.isLoaded()){var o=new L.Control.Fullscreen(s.fullscreen);a.addControl(o)}else e.error("[AngularJS - Leaflet] Fullscreen plugin is not loaded.");if(l(s.custom))for(var i in s.custom)a.addControl(s.custom[i])})}}}}]),angular.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(e,r){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,t,n,o){function l(r){return c(r)&&c(r.coordinates)&&(u.isLoaded()||e.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(r.coordinates)}function i(e,r){return c(e)&&c(r)&&c(r.coordinates)&&c(r.patterns)?(e.setPaths(r.coordinates),e.setPatterns(r.patterns),e):void 0}var s=o.getLeafletScope(),u=r.PolylineDecoratorPlugin,c=r.isDefined,d={};o.getMap().then(function(e){s.$watch("decorations",function(r){for(var a in d)c(r[a])&&angular.equals(r[a],d)||(e.removeLayer(d[a]),delete d[a]);for(var t in r){var n=r[t],o=l(n);c(o)&&(d[t]=o,e.addLayer(o),i(o,n))}},!0)})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletEvents",function(e,r,a,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(r,n,o,l){var i=a.isObject,s=a.isDefined,u=l.getLeafletScope(),c=u.eventBroadcast,d=t.getAvailableMapEvents(),f=t.genDispatchMapEvent;l.getMap().then(function(r){var a,t,n=[],o="broadcast";if(s(c.map))if(i(c.map))if("emit"!==c.map.logic&&"broadcast"!==c.map.logic?e.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):o=c.map.logic,i(c.map.enable)&&c.map.enable.length>=0)for(a=0;a<c.map.enable.length;a++)t=c.map.enable[a],-1===n.indexOf(t)&&-1!==d.indexOf(t)&&n.push(t);else e.warn("[AngularJS - Leaflet] event-broadcast.map.enable must be an object check your model.");else e.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else n=d;for(a=0;a<n.length;a++)t=n[a],r.on(t,f(u,t,o),{eventName:t})})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers","leafletWatchHelpers","leafletDirectiveControlsHelpers","leafletIterators","leafletGeoJsonEvents",function(e,r,a,t,n,o,l,i){var s=n.maybeWatch,u=t.watchOptions,c=o.extend,d=t,f=l;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,r,n,o){var l=t.isDefined,p=o.getLeafletScope(),g={},v=!1;o.getMap().then(function(e){var r=p.geojsonWatchOptions||u,o=function(e,r){var a;return a=angular.isFunction(e.onEachFeature)?e.onEachFeature:function(a,o){t.LabelPlugin.isLoaded()&&l(a.properties.description)&&o.bindLabel(a.properties.description),i.bindEvents(o,null,a,p,r,{resetStyleOnMouseout:e.resetStyleOnMouseout,mapId:n.id})}},y=d.isDefined(n.geojsonNested)&&d.isTruthy(n.geojsonNested),m=function(){if(g){var r=function(r){l(r)&&e.hasLayer(r)&&e.removeLayer(r)};return y?void f.each(g,function(e){r(e)}):void r(g)}},h=function(r,t){var i=angular.copy(r);if(l(i)&&l(i.data)){var s=o(i,t);l(i.options)||(i.options={style:i.style,filter:i.filter,onEachFeature:s,pointToLayer:i.pointToLayer});var u=L.geoJson(i.data,i.options);t&&d.isString(t)?g[t]=u:g=u,u.addTo(e),v||(v=!0,a.setGeoJSON(g,n.id))}},b=function(e){if(m(),y){if(!e||!Object.keys(e).length)return;return void f.each(e,function(e,r){h(e,r)})}h(e)};c(n.id,"geojson",b,m),s(p,"geojson",r,function(e){b(e)})})}}}]),angular.module("leaflet-directive").directive("layercontrol",["$log","leafletData","leafletHelpers",function(e,r,a){return{restrict:"E",scope:{},replace:!0,transclude:!1,require:"^leaflet",controller:["$scope","$element","$sce",function(t,n,o){e.debug("[Angular Directive - Layers] layers",t,n);var l=a.safeApply,i=a.isDefined;angular.extend(t,{baselayer:"",icons:{uncheck:"fa fa-check-square-o",check:"fa fa-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up"},changeBaseLayer:function(e,n){a.safeApply(t,function(a){a.baselayer=e,r.getMap().then(function(n){r.getLayers().then(function(r){if(!n.hasLayer(r.baselayers[e])){for(var o in a.layers.baselayers)a.layers.baselayers[o].icon=a.icons.unradio,n.hasLayer(r.baselayers[o])&&n.removeLayer(r.baselayers[o]);n.addLayer(r.baselayers[e]),a.layers.baselayers[e].icon=t.icons.radio}})})}),n.preventDefault()},moveLayer:function(e,r,a){var n=Object.keys(t.layers.baselayers).length;if(r>=1+n&&r<=t.overlaysArray.length+n){var o;for(var i in t.layers.overlays)if(t.layers.overlays[i].index===r){o=t.layers.overlays[i];break}o&&l(t,function(){o.index=e.index,e.index=r})}a.stopPropagation(),a.preventDefault()},initIndex:function(e,r){var a=Object.keys(t.layers.baselayers).length;e.index=i(e.index)?e.index:r+a+1},toggleOpacity:function(r,a){if(e.debug("Event",r),a.visible){var n=angular.element(r.currentTarget);n.toggleClass(t.icons.close+" "+t.icons.open),n=n.parents(".lf-row").find(".lf-opacity"),n.toggle("fast",function(){l(t,function(){a.opacityControl=!a.opacityControl})})}r.stopPropagation(),r.preventDefault()},unsafeHTML:function(e){return o.trustAsHtml(e)}});var s=n.get(0);L.Browser.touch?L.DomEvent.on(s,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(s),L.DomEvent.on(s,"mousewheel",L.DomEvent.stopPropagation))}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"><div class="lf-baselayers"><div class="lf-row" ng-repeat="(key, layer) in layers.baselayers"><label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"><input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ng-show="false" ng-checked="baselayer === key" ng-value="key" /> <i class="lf-icon lf-icon-radio" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label></div></div><div class="lf-overlays"><div class="lf-container"><div class="lf-row" ng-repeat="layer in overlaysArray | orderBy:\'index\':order" ng-init="initIndex(layer, $index)"><label class="lf-icon-ol"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> <i class="lf-icon lf-icon-check" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div><div class="lf-icons"><i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"></i> <i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"></i> <i class="lf-icon lf-open" ng-class="layer.opacityControl? icons.close:icons.open" ng-click="toggleOpacity($event, layer)"></i></div></label><div class="lf-legend" ng-if="layer.legend" ng-bind-html="unsafeHTML(layer.legend)"></div><div class="lf-opacity" ng-show="layer.visible &amp;&amp; layer.opacityControl"><input type="text" class="lf-opacity-control" name="lf-opacity-control" data-key="{{layer.index}}" /></div></div></div></div></div>',link:function(t,n,o,l){var i=a.isDefined,s=l.getLeafletScope(),u=s.layers;o.order=!i(o.order)||"normal"!==o.order&&"reverse"!==o.order?"normal":o.order,t.order="normal"===o.order,t.orderNumber="normal"===o.order?-1:1,t.layers=u,l.getMap().then(function(a){s.$watch("layers.baselayers",function(e){r.getLayers().then(function(r){var n;for(n in e)e[n].icon=a.hasLayer(r.baselayers[n])?t.icons.radio:t.icons.unradio})}),s.$watch("layers.overlays",function(o){var l=[];r.getLayers().then(function(e){for(var r in o)o[r].icon=t.icons[o[r].visible?"uncheck":"check"],l.push(o[r]),i(o[r].index)&&e.overlays[r].setZIndex&&e.overlays[r].setZIndex(o[r].index)});var s=t.$watch(function(){return n.children().size()>1?(n.find(".lf-overlays").trigger("resize"),n.find(".lf-opacity").size()===Object.keys(u.overlays).length):void 0},function(o){o===!0&&(i(n.find(".lf-opacity-control").ionRangeSlider)?n.find(".lf-opacity-control").each(function(e,n){var o,l=Object.keys(u.baselayers).length;for(var s in t.overlaysArray)t.overlaysArray[s].index===e+l+1&&(o=t.overlaysArray[s]);var c=angular.element(n),d=i(o)&&i(o.layerOptions)?o.layerOptions.opacity:void 0;c.ionRangeSlider({min:0,from:i(d)?Math.ceil(100*d):100,step:1,max:100,prettify:!1,hasGrid:!1,hideMinMax:!0,onChange:function(e){r.getLayers().then(function(r){var t,n,o=e.input.data().key;for(var l in u.overlays)if(u.overlays[l].index===o){t=r.overlays[l],n=u.overlays[l];break}a.hasLayer(t)&&(n.layerOptions=i(n.layerOptions)?n.layerOptions:{},n.layerOptions.opacity=e.input.val()/100,t.setOpacity&&t.setOpacity(e.input.val()/100),t.getLayers&&t.eachLayer&&t.eachLayer(function(r){r.setOpacity&&r.setOpacity(e.input.val()/100)}))})}})}):e.warn("[AngularJS - Leaflet] Ion Slide Range Plugin is not loaded"),s())});t.overlaysArray=l},!0)})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(e,r,a,t,n,o){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:["$scope",function(e){e._leafletLayers=r.defer(),this.getLayers=function(){return e._leafletLayers.promise}}],link:function(e,r,l,i){var s=t.isDefined,u={},c=i.getLeafletScope(),d=c.layers,f=n.createLayer,p=o.updateLayersControl,g=!1;i.getMap().then(function(r){e._leafletLayers.resolve(u),a.setLayers(u,l.id),u.baselayers={},u.overlays={};var t=l.id,n=!1;for(var o in d.baselayers){var i=f(d.baselayers[o]);s(i)?(u.baselayers[o]=i,d.baselayers[o].top===!0&&(r.addLayer(u.baselayers[o]),n=!0)):delete d.baselayers[o]}!n&&Object.keys(u.baselayers).length>0&&r.addLayer(u.baselayers[Object.keys(d.baselayers)[0]]);for(o in d.overlays){"cartodb"===d.overlays[o].type;var v=f(d.overlays[o]);s(v)?(u.overlays[o]=v,d.overlays[o].visible===!0&&r.addLayer(u.overlays[o])):delete d.overlays[o]}c.$watch("layers.baselayers",function(e,a){if(!angular.equals(e,a)){for(var n in u.baselayers)(!s(e[n])||e[n].doRefresh)&&(r.hasLayer(u.baselayers[n])&&r.removeLayer(u.baselayers[n]),delete u.baselayers[n],e[n]&&e[n].doRefresh&&(e[n].doRefresh=!1));for(var o in e)if(s(u.baselayers[o]))e[o].top!==!0||r.hasLayer(u.baselayers[o])?e[o].top===!1&&r.hasLayer(u.baselayers[o])&&r.removeLayer(u.baselayers[o]):r.addLayer(u.baselayers[o]);else{var l=f(e[o]);s(l)&&(u.baselayers[o]=l,e[o].top===!0&&r.addLayer(u.baselayers[o]))}var i=!1;for(var c in u.baselayers)if(r.hasLayer(u.baselayers[c])){i=!0;break}!i&&Object.keys(u.baselayers).length>0&&r.addLayer(u.baselayers[Object.keys(u.baselayers)[0]]),g=p(r,t,g,e,d.overlays,u)}},!0),c.$watch("layers.overlays",function(e,a){if(!angular.equals(e,a)){for(var n in u.overlays)(!s(e[n])||e[n].doRefresh)&&(r.hasLayer(u.overlays[n])&&r.removeLayer(u.overlays[n]),delete u.overlays[n],e[n]&&e[n].doRefresh&&(e[n].doRefresh=!1));for(var o in e){if(!s(u.overlays[o])){var l=f(e[o]);if(!s(l))continue;u.overlays[o]=l,e[o].visible===!0&&r.addLayer(u.overlays[o])}e[o].visible&&!r.hasLayer(u.overlays[o])?r.addLayer(u.overlays[o]):e[o].visible===!1&&r.hasLayer(u.overlays[o])&&r.removeLayer(u.overlays[o]),e[o].visible&&r._loaded&&e[o].data&&"heatmap"===e[o].type&&(u.overlays[o].setData(e[o].data),u.overlays[o].update())}g=p(r,t,g,d.baselayers,e,u)}},!0)})}}}]),angular.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(e,r,a,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(n,o,l,i){var s,u,c,d,f=a.isArray,p=a.isDefined,g=a.isFunction,v=i.getLeafletScope(),y=v.legend;v.$watch("legend",function(e){p(e)&&(s=e.legendClass?e.legendClass:"legend",u=e.position||"bottomright",d=e.type||"arcgis")},!0),i.getMap().then(function(a){v.$watch("legend",function(r){return p(r)?p(r.url)||"arcgis"!==d||f(r.colors)&&f(r.labels)&&r.colors.length===r.labels.length?p(r.url)?void e.info("[AngularJS - Leaflet] loading legend service."):(p(c)&&(c.removeFrom(a),c=null),c=L.control({position:u}),"arcgis"===d&&(c.onAdd=t.getOnAddArrayLegend(r,s)),void c.addTo(a)):void e.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set."):void(p(c)&&(c.removeFrom(a),c=null))}),v.$watch("legend.url",function(n){p(n)&&r.get(n).success(function(e){p(c)?t.updateLegend(c.getContainer(),e,d,n):(c=L.control({position:u}),c.onAdd=t.getOnAddLegend(e,s,d,n),c.addTo(a)),p(y.loadedData)&&g(y.loadedData)&&y.loadedData()}).error(function(){e.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletMarkerEvents","leafletIterators","leafletWatchHelpers","leafletDirectiveControlsHelpers",function(e,r,a,t,n,o,l,i,s,u,c){var d=n.isDefined,f=n.errorHeader,p=n,g=n.isString,v=l.addMarkerWatcher,y=l.listenMarkerEvents,m=l.addMarkerToGroup,h=l.createMarker,b=l.deleteMarker,k=s,A=n.watchOptions,C=u.maybeWatch,w=c.extend,O=function(r,a,t,n,o,i){if(!g(r))return e.error(f+" A layername must be a string"),!1;if(!d(a))return e.error(f+" You must add layers to the directive if the markers are going to use this functionality."),!1;if(!d(a.overlays)||!d(a.overlays[r]))return e.error(f+' A marker can only be added to a layer of type "group"'),!1;var s=a.overlays[r];return s instanceof L.LayerGroup||s instanceof L.FeatureGroup?(s.addLayer(n),!o&&i.hasLayer(n)&&t.focus===!0&&l.manageOpenPopup(n,t),!0):(e.error(f+' Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"'),!1)},D=function(r,a,t,n,o,s,u){for(var c in r)if(-1===c.search("-")){if(!d(n[c])){var g=p.copy(r[c]),L=h(g),b=(g?g.layer:void 0)||u;if(!d(L)){e.error(f+" Received invalid data on the marker "+c+".");continue}if(n[c]=L,d(g.message)&&L.bindPopup(g.message,g.popupOptions),d(g.group)){var k=d(g.groupOption)?g.groupOption:null;m(L,g.group,k,a)}if(p.LabelPlugin.isLoaded()&&d(g.label)&&d(g.label.message)&&L.bindLabel(g.label.message,g.label.options),d(g)&&(d(g.layer)||d(u))){var A=O(b,t,g,L,s.individual.doWatch,a);if(!A)continue}else d(g.group)||(a.addLayer(L),s.individual.doWatch||g.focus!==!0||l.manageOpenPopup(L,g));var C=p.getObjectDotPath(u?[u,c]:[c]);s.individual.doWatch&&v(L,C,o,t,a,s.individual.doWatch),y(L,g,o,s.individual.doWatch),i.bindEvents(L,C,g,o,b)}}else e.error('The marker can\'t use a "-" on his key name: "'+c+'".')},H=function(r,a,t,n,o){var l=!1,i=!1,s=d(a);for(var u in t)l||(e.debug(f+"[markers] destroy: "),l=!0),s&&(i=!angular.equals(r[u],a[u])),d(r)&&Object.keys(r).length&&d(r[u])&&Object.keys(r[u]).length&&!i||(b(t[u],n,o),delete t[u])};return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(e,r,n,o){var l=o[0],i=l.getLeafletScope();l.getMap().then(function(e){var r,l={};r=d(o[1])?o[1].getLayers:function(){var e=a.defer();return e.resolve(),e.promise};var s=i.markersWatchOptions||A;d(n.watchMarkers)&&(s.doWatch=s.individual.doWatch=!d(n.watchMarkers)||p.isTruthy(n.watchMarkers));var u=d(n.markersNested)&&p.isTruthy(n.markersNested);r().then(function(r){var a=function(a,t){H(a,t,l,e,r)},o=function(t,n){return a(t,n),u?void k.each(t,function(a,t){D(a,e,r,l,i,s,t)}):void D(t,e,r,l,i,s)};w(n.id,"markers",o,a),t.setMarkers(l,n.id),C(i,"markers",s,function(e,r){o(e,r)})})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers","leafletHelpers",function(e,r,a,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,r,n,o){var l=o.getLeafletScope(),i=a.isValidBounds,s=t.isNumber;o.getMap().then(function(e){l.$watch("maxbounds",function(r){if(!i(r))return void e.setMaxBounds();var t=a.createLeafletBounds(r);s(r.pad)&&(t=t.pad(r.pad)),e.setMaxBounds(t),n.center||e.fitBounds(t)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(e,r,a,t,n,o,l){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(i,s,u,c){var d=c[0],f=n.isDefined,p=n.isString,g=d.getLeafletScope(),v=g.paths,y=o.createPath,m=l.bindPathEvents,h=o.setPathOptions;d.getMap().then(function(o){var l,i=t.getDefaults(u.id);l=f(c[1])?c[1].getLayers:function(){var e=r.defer();return e.resolve(),e.promise},f(v)&&l().then(function(r){var t={};a.setPaths(t,u.id);var l=!f(u.watchPaths)||"true"===u.watchPaths,s=function(e,a){var t=g.$watch('paths["'+a+'"]',function(a,n){if(!f(a)){if(f(n.layer))for(var l in r.overlays){var i=r.overlays[l];i.removeLayer(e)}return o.removeLayer(e),void t()}h(e,a.type,a)},!0)};g.$watchCollection("paths",function(a){for(var u in t)f(a[u])||(o.removeLayer(t[u]),delete t[u]);for(var c in a)if(0!==c.search("\\$"))if(-1===c.search("-")){if(!f(t[c])){var d=a[c],v=y(c,a[c],i);if(f(v)&&f(d.message)&&v.bindPopup(d.message),n.LabelPlugin.isLoaded()&&f(d.label)&&f(d.label.message)&&v.bindLabel(d.label.message,d.label.options),f(d)&&f(d.layer)){if(!p(d.layer)){e.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!f(r)){e.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!f(r.overlays)||!f(r.overlays[d.layer])){e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var b=r.overlays[d.layer];if(!(b instanceof L.LayerGroup||b instanceof L.FeatureGroup)){e.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}t[c]=v,b.addLayer(v),l?s(v,c):h(v,d.type,d)}else f(v)&&(t[c]=v,o.addLayer(v),l?s(v,c):h(v,d.type,d));m(v,c,d,g)}}else e.error('[AngularJS - Leaflet] The path name "'+c+'" is not valid. It must not include "-" and a number.')})})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(e,r,a,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(n,o,l,i){var s=t.isDefined,u=i.getLeafletScope(),c=u.tiles;return s(c)||s(c.url)?void i.getMap().then(function(e){var t,n=a.getDefaults(l.id);u.$watch("tiles",function(a){var o=n.tileLayerOptions,i=n.tileLayer;return!s(a.url)&&s(t)?void e.removeLayer(t):s(t)?s(a.url)&&s(a.options)&&!angular.equals(a.options,o)?(e.removeLayer(t),o=n.tileLayerOptions,angular.copy(a.options,o),i=a.url,t=L.tileLayer(i,o),t.addTo(e),void r.setTiles(t,l.id)):void(s(a.url)&&t.setUrl(a.url)):(s(a.options)&&angular.copy(a.options,o),s(a.url)&&(i=a.url),t=L.tileLayer(i,o),t.addTo(e),void r.setTiles(t,l.id))},!0)}):void e.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),["markers","geojson"].forEach(function(e){angular.module("leaflet-directive").directive(e+"WatchOptions",["$log","$rootScope","$q","leafletData","leafletHelpers",function(r,a,t,n,o){var l=o.isDefined,i=o.errorHeader,s=o.isObject,u=o.watchOptions;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(a,t,n,o){var c=o[0],d=c.getLeafletScope();c.getMap().then(function(){l(a[e+"WatchOptions"])&&(s(a[e+"WatchOptions"])?angular.extend(u,a[e+"WatchOptions"]):r.error(i+"["+e+"WatchOptions] is not an object"),d[e+"WatchOptions"]=u)})}}}])}),angular.module("leaflet-directive").factory("leafletEventsHelpersFactory",["$rootScope","$q","$log","leafletHelpers",function(e,r,a,t){var n=t.safeApply,o=t.isDefined,l=t.isObject,i=t.isArray,s=function(e,r){this.rootBroadcastName=e,this.lObjectType=r};return s.prototype.getAvailableEvents=function(){return[]},s.prototype.genDispatchEvent=function(e,r,a,t,n,o,l,i){var s=this;return function(u){var c=s.rootBroadcastName+"."+e;s.fire(a,c,r,u,u.target||t,o,n,l,i)}},s.prototype.fire=function(r,a,t,l,i,s,u,c,d){n(r,function(){var n={leafletEvent:l,leafletObject:i,modelName:u,model:s};o(c)&&angular.extend(n,{layerName:c}),"emit"===t?r.$emit(a,n):e.$broadcast(a,n)})},s.prototype.bindEvents=function(e,r,t,n,s,u){var c=[],d="emit",f=this;if(o(n.eventBroadcast))if(l(n.eventBroadcast))if(o(n.eventBroadcast[f.lObjectType]))if(l(n.eventBroadcast[f.lObjectType])){o(n.eventBroadcast[this.lObjectType].logic)&&"emit"!==n.eventBroadcast[f.lObjectType].logic&&"broadcast"!==n.eventBroadcast[f.lObjectType].logic&&a.warn(errorHeader+"Available event propagation logic are: 'emit' or 'broadcast'.");var p=!1,g=!1;o(n.eventBroadcast[f.lObjectType].enable)&&i(n.eventBroadcast[f.lObjectType].enable)&&(p=!0),o(n.eventBroadcast[f.lObjectType].disable)&&i(n.eventBroadcast[f.lObjectType].disable)&&(g=!0),p&&g?a.warn(errorHeader+"can not enable and disable events at the same time"):p||g?p?n.eventBroadcast[this.lObjectType].enable.forEach(function(e){-1!==c.indexOf(e)?a.warn(errorHeader+"This event "+e+" is already enabled"):-1===f.getAvailableEvents().indexOf(e)?a.warn(errorHeader+"This event "+e+" does not exist"):c.push(e)}):(c=this.getAvailableEvents(),n.eventBroadcast[f.lObjectType].disable.forEach(function(e){var r=c.indexOf(e);-1===r?a.warn(errorHeader+"This event "+e+" does not exist or has been already disabled"):c.splice(r,1)})):a.warn(errorHeader+"must enable or disable events")}else a.warn(errorHeader+"event-broadcast."+[f.lObjectType]+" must be an object check your model.");else c=this.getAvailableEvents();else a.error(errorHeader+"event-broadcast must be an object check your model.");else c=this.getAvailableEvents();return c.forEach(function(a){e.on(a,f.genDispatchEvent(a,d,n,e,r,t,s,u))}),d},s}]).service("leafletEventsHelpers",["leafletEventsHelpersFactory",function(e){return new e}]),angular.module("leaflet-directive").factory("leafletGeoJsonEvents",["$rootScope","$q","$log","leafletHelpers","leafletEventsHelpersFactory","leafletLabelEvents","leafletData",function(e,r,a,t,n,o,l){var i=t.safeApply,s=(t.isDefined,n),u=function(){s.call(this,"leafletDirectiveGeoJson","geojson")};return u.prototype=new s,
u.prototype.genDispatchEvent=function(r,a,t,n,o,u,c,d){var f=s.prototype.genDispatchEvent.call(this,r,a,t,n,o,u,c),p=this;return function(a){"mouseout"===r&&(d.resetStyleOnMouseout&&l.getGeoJSON(d.mapId).then(function(e){var r=c?e[c]:e;r.resetStyle(a.target)}),i(t,function(){e.$broadcast(p.rootBroadcastName+".mouseout",a)})),f(a)}},u.prototype.getAvailableEvents=function(){return["click","dblclick","mouseover","mouseout"]},new u}]),angular.module("leaflet-directive").factory("leafletLabelEvents",["$rootScope","$q","$log","leafletHelpers","leafletEventsHelpersFactory",function(e,r,a,t,n){var o=t,l=n,i=function(){l.call(this,"leafletDirectiveLabel","markers")};return i.prototype=new l,i.prototype.genDispatchEvent=function(e,r,a,t,n,o,i){var s=n.replace("markers.","");return l.prototype.genDispatchEvent.call(this,e,r,a,t,s,o,i)},i.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},i.prototype.genEvents=function(e,r,a,t,n,l,i){var s=this,u=this.getAvailableEvents(),c=o.getObjectArrayPath("markers."+n);u.forEach(function(e){t.label.on(e,s.genDispatchEvent(e,r,a,t.label,c,l,i))})},i.prototype.bindEvents=function(e,r,a,t,n){},new i}]),angular.module("leaflet-directive").factory("leafletMapEvents",["$rootScope","$q","$log","leafletHelpers","leafletEventsHelpers",function(e,r,a,t,n){var o=(t.safeApply,t.isDefined),l=(t.isObject,t.errorHeader,n.fire),i=function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},s=function(e,r,a){return function(t){var n="leafletDirectiveMap."+r;l(e,n,a,t,t.target,e)}},u=function(e){e.$broadcast("boundsChanged")},c=function(e,r,a,t){if(o(a.urlHashCenter)){var n=r.getCenter(),l=n.lat.toFixed(4)+":"+n.lng.toFixed(4)+":"+r.getZoom();o(t.c)&&t.c===l||e.$emit("centerUrlHash",l)}};return{getAvailableMapEvents:i,genDispatchMapEvent:s,notifyCenterChangedToBounds:u,notifyCenterUrlHashChanged:c}}]),angular.module("leaflet-directive").factory("leafletMarkerEvents",["$rootScope","$q","$log","leafletHelpers","leafletEventsHelpersFactory","leafletLabelEvents",function(e,r,a,t,n,o){var l=t.safeApply,i=t.isDefined,s=t,u=o,c=n,d=function(){c.call(this,"leafletDirectiveMarker","markers")};return d.prototype=new c,d.prototype.genDispatchEvent=function(r,a,t,n,o,i,s){var u=c.prototype.genDispatchEvent.call(this,r,a,t,n,o,i,s);return function(a){"click"===r?l(t,function(){e.$broadcast("leafletDirectiveMarkersClick",o)}):"dragend"===r&&(l(t,function(){i.lat=n.getLatLng().lat,i.lng=n.getLatLng().lng}),i.message&&i.focus===!0&&n.openPopup()),u(a)}},d.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]},d.prototype.bindEvents=function(e,r,a,t,n){var o=c.prototype.bindEvents.call(this,e,r,a,t,n);s.LabelPlugin.isLoaded()&&i(e.label)&&u.genEvents(r,o,t,e,a,n)},new d}]),angular.module("leaflet-directive").factory("leafletPathEvents",["$rootScope","$q","$log","leafletHelpers","leafletLabelEvents","leafletEventsHelpers",function(e,r,a,t,n,o){var l=(t.safeApply,t.isDefined),i=t.isObject,s=t,u=t.errorHeader,c=n,d=o.fire,f=function(e,r,a,t,n,o,l){return function(i){var s="leafletDirectivePath."+e;d(a,s,r,i,i.target||t,o,n,l)}},p=function(e,r,t,n){var o,d,p=[],v="broadcast";if(l(n.eventBroadcast))if(i(n.eventBroadcast))if(l(n.eventBroadcast.path))if(i(n.eventBroadcast.paths))a.warn(u+"event-broadcast.path must be an object check your model.");else{void 0!==n.eventBroadcast.path.logic&&null!==n.eventBroadcast.path.logic&&("emit"!==n.eventBroadcast.path.logic&&"broadcast"!==n.eventBroadcast.path.logic?a.warn(u+"Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===n.eventBroadcast.path.logic&&(v="emit"));var y=!1,m=!1;if(void 0!==n.eventBroadcast.path.enable&&null!==n.eventBroadcast.path.enable&&"object"==typeof n.eventBroadcast.path.enable&&(y=!0),void 0!==n.eventBroadcast.path.disable&&null!==n.eventBroadcast.path.disable&&"object"==typeof n.eventBroadcast.path.disable&&(m=!0),y&&m)a.warn(u+"can not enable and disable events at the same time");else if(y||m)if(y)for(o=0;o<n.eventBroadcast.path.enable.length;o++)d=n.eventBroadcast.path.enable[o],-1!==p.indexOf(d)?a.warn(u+"This event "+d+" is already enabled"):-1===g().indexOf(d)?a.warn(u+"This event "+d+" does not exist"):p.push(d);else for(p=g(),o=0;o<n.eventBroadcast.path.disable.length;o++){d=n.eventBroadcast.path.disable[o];var h=p.indexOf(d);-1===h?a.warn(u+"This event "+d+" does not exist or has been already disabled"):p.splice(h,1)}else a.warn(u+"must enable or disable events")}else p=g();else a.error(u+"event-broadcast must be an object check your model.");else p=g();for(o=0;o<p.length;o++)d=p[o],e.on(d,f(d,v,n,p,r));s.LabelPlugin.isLoaded()&&l(e.label)&&c.genLabelEvents(r,v,n,e,t)},g=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailablePathEvents:g,bindPathEvents:p}}])}(angular),angular.module("mapApp",["ui.bootstrap","leaflet-directive"]),angular.module("mapApp").factory("layers",function(){var e={};return e.list={},e.colors=["yellows_reds","blues","greens","greys","oranges","purples","reds"],e.getNextColorScheme=function(){return e.colors[Object.keys(e.list).length%e.colors.length]},e.addSpecies=function(r){e.list[r.canonicalName]={name:r.canonicalName,url:"http://cdn.gbif.org/v1/map/density/tile.png?key="+r.speciesKey+"&resolution=4&x={x}&y={y}&z={z}&type=TAXON&palette="+e.getNextColorScheme(),type:"xyz",visible:!0}},e}),function(){function e(e,r){var a=this;angular.extend(a,{Earth:{lat:0,lng:0,zoom:2},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}},overlays:r.list}})}angular.module("mapApp").controller("MapController",e),e.$inject=["$scope","layers"]}(),function(){function e(e,r,a){var t=this;t.species="",t.getSpecies=function(r){return url="//api.gbif.org/v1/species/suggest?callback=JSON_CALLBACK&rank=SPECIES&q="+encodeURIComponent(r),e.jsonp(url).then(function(e){return a(e.data,5)})},t.add=function(e){r.addSpecies(e)},t.isValid=function(){return!!t.species&&!!t.species.speciesKey}}angular.module("mapApp").controller("SuggestController",e),e.$inject=["$http","layers","limitToFilter"]}(),function(){function e(e){var r=this;r.visible=!0,r.layers=e.list,r.remove=function(e){delete r.layers[e.name],r.isEmpty()&&(r.visible=!0)},r.isVisible=function(){return r.visible},r.isEmpty=function(){return 0===Object.keys(r.layers).length}}angular.module("mapApp").controller("LayerController",e),e.$inject=["layers"]}();